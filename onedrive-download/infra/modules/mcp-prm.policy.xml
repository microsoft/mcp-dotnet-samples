<!--
    Azure API Management Policy for Protected Resource Metadata (RFC 9728)
    This policy returns Protected Resource Metadata information for OAuth 2.0 protected resources.
    It provides clients with information about the authorization servers, supported methods, and scopes.
    Note: Authentication is disabled for this endpoint to allow anonymous access.
-->
<policies>
    <inbound>
        <base />

        <set-variable name="prm_client_id" value="{{McpClientId}}" />
        <set-variable name="prm_tenant_id" value="{{McpTenantId}}" />

        <return-response>
            <set-status code="200" />
            <set-header name="Content-Type" exists-action="override">
                <value>application/json</value>
            </set-header>

            <set-body template="liquid">
            {
                "authorization_endpoint": "https://login.microsoftonline.com/{{context.Variables["prm_tenant_id"]}}/oauth2/v2.0/authorize",
                "token_endpoint": "https://login.microsoftonline.com/{{context.Variables["prm_tenant_id"]}}/oauth2/v2.0/token",

                "client_id": "{{context.Variables["prm_client_id"]}}",

                "scopes_supported": ["https://graph.microsoft.com/.default", "offline_access"],
                "scopes_required": ["https://graph.microsoft.com/.default"],
                "response_types_supported": ["code"],
                "code_challenge_methods_supported": ["S256"],
                "token_endpoint_auth_methods_supported": ["none"],
                "grant_types_supported": ["authorization_code", "refresh_token"]
            }
            </set-body>
        </return-response>
    </inbound>
    <backend>
        <base />
    </backend>
    <outbound>
        <base />
    </outbound>
    <on-error>
        <base />
    </on-error>
</policies>