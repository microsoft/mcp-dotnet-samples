
# Hugging Face MCP Server: AI Image Generation with C#

This sample demonstrates how to use a C# Console Application to connect to the [Hugging Face MCP Server](https://huggingface.co/settings/mcp) and generate AI images using the Model Context Protocol (MCP).

---

## üöÄ Overview

With this sample, you can:

- Connect to the Hugging Face MCP Server using the MCP SDK for .NET
- List available tools (including image generation)
- Generate images from text prompts (e.g., "create a pixelated image of a beaver")
- Use either cloud-hosted models (GitHub, Azure AI Foundry) or local models (Ollama)

---

## üõ†Ô∏è Project Structure

| Project | Description |
|---------|-------------|
| [`src/MCP-01-HuggingFace/Program.cs`](./src/MCP-01-HuggingFace/Program.cs) | Uses GitHub Models or Azure AI Foundry models via the Hugging Face MCP Server |
| [`src/MCP-02-HuggingFace-Ollama/Program.cs`](./src/MCP-02-HuggingFace-Ollama/Program.cs) | Uses a local model with Ollama via the Hugging Face MCP Server |

---

## ‚ö° Quick Start

### Prerequisites

- [.NET 9 SDK](https://dotnet.microsoft.com/download/dotnet/9.0)
- [Hugging Face MCP Server access](https://huggingface.co/settings/mcp)
- (Optional) [Ollama](https://ollama.com/) for local model inference
- (Optional) GitHub Token or Azure AI Foundry credentials

### 1. Clone the Repository

```pwsh
git clone https://github.com/microsoft/mcp-dotnet-samples.git
cd mcp-dotnet-samples/huggingface-genimages
```

### 2. Configure Secrets

Set your Hugging Face and (optionally) GitHub tokens using [User Secrets](https://learn.microsoft.com/aspnet/core/security/app-secrets) or environment variables:

```pwsh
# Example for User Secrets
dotnet user-secrets set "HF_API_KEY" "<your_hf_token>"
dotnet user-secrets set "GITHUB_TOKEN" "<your_github_token>"
# For Azure AI Foundry, set endpoint, apikey, and deploymentName as needed
```

### 3. Run the Sample

#### Using GitHub or Azure AI Foundry Models

```pwsh
dotnet run --project ./src/MCP-01-HuggingFace
```

#### Using a Local Model with Ollama

Start Ollama locally, then run:

```pwsh
dotnet run --project ./src/MCP-02-HuggingFace-Ollama
```

---

## üìù Example Output

The app will:

1. Connect to the Hugging Face MCP Server
2. List available tools
3. Generate an image from a prompt

Sample prompt:

> create a pixelated image of a beaver

Sample output image:

![Beaver generated by the Hugging Face MCP Server](./images/gen%20image%20beaver.png)

---

## üíª Code Snippets

### Connecting to the Hugging Face MCP Server

```csharp
var hfHeaders = new Dictionary<string, string>
{
	{ "Authorization", $"Bearer {config["HF_API_KEY"]}" }
};
var clientTransport = new SseClientTransport(
	new()
	{
		Name = "HF Server",
		Endpoint = new Uri("https://huggingface.co/mcp"),
		AdditionalHeaders = hfHeaders
	});
await using var mcpClient = await McpClientFactory.CreateAsync(clientTransport);
```

### Listing Available Tools

```csharp
var tools = await mcpClient.ListToolsAsync();
foreach (var tool in tools)
{
	Console.WriteLine($"Connected to server with tools: {tool.Name}");
}
```

### Generating an Image

```csharp
IChatClient client = GetChatClient();
var chatOptions = new ChatOptions
{
	Tools = [.. tools],
	ModelId = deploymentName
};
var query = "Create an image of a pixelated beaver.";
var result = await client.GetResponseAsync(query, chatOptions);
Console.Write($"AI response: {result}");
```

---

## üîó References & Resources

- [Hugging Face MCP Server](https://huggingface.co/settings/mcp)
- [C# MCP SDK](https://github.com/modelcontextprotocol/csharp-sdk)
- [GitHub Models](https://github.com/marketplace?type=models)
- [Ollama](https://ollama.com/)
- [Blog post: Using C# to Call Hugging Face MCP Server and Generate AI Images](https://elbruno.com/2025/07/21/%f0%9f%a4%96-using-c-to-call-hugging-face-mcp-server-and-generate-ai-images/)
